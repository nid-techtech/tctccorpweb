---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import type { CollectionEntry } from "astro:content";

export async function getStaticPaths() {
    const blogEntries = await getCollection("docs");
    return blogEntries
        .filter((entry) => entry.slug !== "index")
        .map((entry) => ({
            params: { slug: entry.slug },
            props: { entry },
        }));
}

interface Props {
    entry: CollectionEntry<"docs">;
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<BaseLayout
    title={entry.data.title || "TECHâ˜†TECH"}
    description={entry.data.description}
>
    <Header />
    <main>
        {
            entry.data.cover && (
                <div class="cover-image">
                    <Image
                        src={entry.data.cover}
                        alt="Cover"
                        loading="eager"
                        fetchpriority="high"
                        inferSize={true}
                    />
                </div>
            )
        }
        <article class="prose">
            <header class="article-header">
                <h1>{entry.data.title}</h1>
                {
                    entry.data.subtitle && (
                        <p class="subtitle">{entry.data.subtitle}</p>
                    )
                }
                <div class="meta">
                    <span class="date"
                        >Created: {
                            entry.data.created_at?.toLocaleDateString()
                        }</span
                    >
                    {
                        entry.data.updated_at && (
                            <span class="date">
                                Updated:{" "}
                                {entry.data.updated_at.toLocaleDateString()}
                            </span>
                        )
                    }
                    {
                        entry.data.author && (
                            <span class="author">By {entry.data.author}</span>
                        )
                    }
                </div>
                {
                    entry.data.tags && entry.data.tags.length > 0 && (
                        <div class="tags">
                            {entry.data.tags.map((tag) => (
                                <span class="tag">#{tag}</span>
                            ))}
                        </div>
                    )
                }
            </header>
            <Content />
        </article>
    </main>
    <Footer />
</BaseLayout>

<style>
    main {
        max-width: 1080px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }
    .cover-image img {
        width: 100%;
        height: auto;
        border-radius: 8px;
        margin-bottom: 2rem;
    }
    .prose {
        line-height: 1.6;
    }
    .article-header {
        margin-bottom: 2rem;
        border-bottom: 1px solid var(--color-border);
        padding-bottom: 1rem;
        transition: border-color 0.3s;
    }
    .subtitle {
        font-size: 1.2rem;
        color: var(--color-secondary);
        margin: 0.5rem 0;
    }
    .meta {
        font-size: 0.9rem;
        color: var(--color-secondary);
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
    }
    .tags {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 0.5rem;
    }
    .tag {
        background: var(--color-code-bg);
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-size: 0.8rem;
    }
</style>
