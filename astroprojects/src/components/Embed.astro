---
interface Props {
  url: string;
  type?: 'youtube' | 'imgur' | 'link';
  title?: string;
}

const { url, type = 'link', title } = Astro.props;

function getYouTubeId(url: string) {
  const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
  const match = url.match(regExp);
  return (match && match[2].length === 11) ? match[2] : null;
}

const youtubeId = type === 'youtube' || url.includes('youtube') || url.includes('youtu.be') ? getYouTubeId(url) : null;
const isImgur = type === 'imgur' || url.includes('imgur.com');
---

<div class="embed-container">
  {youtubeId ? (
    <iframe
      src={`https://www.youtube.com/embed/${youtubeId}`}
      title={title || "YouTube video player"}
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
    ></iframe>
  ) : isImgur ? (
     /* Imgur usually needs .png/.jpg. If link is just post ID, might need transformation. */
     /* Assuming direct link or .png appended for simplicity, or embed iframe */
     <blockquote class="imgur-embed-pub" lang="en" data-id={url.split('/').pop()}><a href={url}>{title || "View post on Imgur"}</a></blockquote>
     <script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script>
  ) : (
    <a href={url} class="link-card" target="_blank" rel="noopener noreferrer">
       <div class="link-info">
           <span class="link-title">{title || url}</span>
           <span class="link-url">{url}</span>
       </div>
    </a>
  )}
</div>

<style>
.embed-container {
    margin: 1.5rem 0;
    width: 100%;
    display: flex;
    justify-content: center;
}
iframe {
    width: 100%;
    max-width: 800px;
    aspect-ratio: 16/9;
    border: none;
    border-radius: 8px;
}
.link-card {
    display: block;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 1rem;
    width: 100%;
    background: var(--color-code-bg);
    transition: transform 0.1s, border-color 0.3s;
}
.link-card:hover {
    transform: translateY(-2px);
    text-decoration: none;
}
.link-title {
    display: block;
    font-weight: bold;
    margin-bottom: 0.5rem;
}
.link-url {
    font-size: 0.8rem;
    color: var(--color-secondary);
}
</style>
